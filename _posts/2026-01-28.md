from appium.webdriver.common.appiumby import AppiumBy
from selenium.common.exceptions import NoSuchElementException
import time

def create_cards_until_10(driver):
    CARD_ID = "com.example.app:id/card_item"
    ADD_BTN_ID = "com.example.app:id/btn_add"
    INPUT_ID = "com.example.app:id/input_name"
    SAVE_BTN_ID = "com.example.app:id/btn_save"
    DUPLICATE_TEXT = "중복입니다"

    cards = driver.find_elements(AppiumBy.ID, CARD_ID)
    need_count = 10 - len(cards)

    if need_count <= 0:
        return

    name_index = 1
    created = 0

    while created < need_count:
        driver.find_element(AppiumBy.ID, ADD_BTN_ID).click()
        time.sleep(0.5)

        name = f"test_{name_index}"
        input_el = driver.find_element(AppiumBy.ID, INPUT_ID)
        input_el.clear()
        input_el.send_keys(name)

        driver.find_element(AppiumBy.ID, SAVE_BTN_ID).click()
        time.sleep(0.5)

        try:
            driver.find_element(
                AppiumBy.ANDROID_UIAUTOMATOR,
                f'new UiSelector().text("{DUPLICATE_TEXT}")'
            )
            name_index += 1
            driver.back()   # 생성 화면 유지 or 다시 입력 가능 구조면 제거
            continue
        except NoSuchElementException:
            created += 1
            name_index += 1
            time.sleep(1)
