---
layout: posts
title: "[Playwright] ë¡œê·¸ì¸ ì„¸ì…˜ ìœ ì§€í•˜ê¸° (storageState)"
categories: ['sqa']
tags: [playwright]
---
<br/>

# Playwright ë¡œê·¸ì¸ ì„¸ì…˜ ì¬ì‚¬ìš© íŒ¨í„´ (storageState)

## 1. ì´ íŒ¨í„´ì´ í•„ìš”í•œ ì´ìœ 

ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ë¥¼ ë§¤ë²ˆ í•˜ë©´ ë¬¸ì œê°€ ìƒê¸´ë‹¤.

- í…ŒìŠ¤íŠ¸ ëŠë ¤ì§
- CAPTCHA / ë³´ì•ˆ ì •ì±…ì— ë§‰í˜
- ë¡œê·¸ì¸ ì‹¤íŒ¨ë¡œ ì „ì²´ í…ŒìŠ¤íŠ¸ ë¶ˆì•ˆì •
- ë¡œê·¸ì¸ ë¡œì§ ë³€ê²½ ì‹œ ëª¨ë“  í…ŒìŠ¤íŠ¸ ìˆ˜ì • í•„ìš”

ğŸ‘‰ **í•´ê²°ì±…**

ë¡œê·¸ì¸ì€ **í•œ ë²ˆë§Œ ìˆ˜í–‰**í•˜ê³ 

ê·¸ ê²°ê³¼(ì¿ í‚¤, localStorage)ë¥¼ ì €ì¥í•´ì„œ **ì¬ì‚¬ìš©**í•œë‹¤.

Playwrightì—ì„œëŠ” ì´ê±¸ `storageState`ë¡œ í•œë‹¤.

---

## 2. ì „ì²´ êµ¬ì¡° í•œëˆˆì— ë³´ê¸°

```
playwright/
â”œâ”€ auth/
â”‚  â””â”€ login.setup.ts        # ë¡œê·¸ì¸ 1íšŒ ìˆ˜í–‰ + ì„¸ì…˜ ì €ì¥
â”‚
â”œâ”€ pages/
â”‚  â””â”€ login.page.ts         # ë¡œê·¸ì¸ Page Object
â”‚
â”œâ”€ tests/
â”‚  â””â”€ main.spec.ts          # ë¡œê·¸ì¸ ì´í›„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
â”‚
â”œâ”€ .auth/
â”‚  â””â”€ user.json             # ë¡œê·¸ì¸ ì„¸ì…˜ ê²°ê³¼ë¬¼ (ìë™ ìƒì„±)
â”‚
â”œâ”€ playwright.config.ts
â””â”€ package.json

```

í•µì‹¬ ê°œë…:

- `.auth/user.json`
    
    â†’ **ì‚¬ëŒì´ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤**
    
    â†’ setup í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí•´ì•¼ ìë™ ìƒì„±ë¨
    

---

## 3. ë™ì‘ íë¦„ (ì¤‘ìš”)

```
[setup í”„ë¡œì íŠ¸]
  â†“
ë¡œê·¸ì¸ í˜ì´ì§€ ì ‘ì†
  â†“
ID / PW ì…ë ¥
  â†“
ë¡œê·¸ì¸ ì„±ê³µ í™•ì¸ (URL or í™”ë©´ ìš”ì†Œ)
  â†“
storageState ì €ì¥ (.auth/user.json)

====================================

[ì¼ë°˜ í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸]
  â†“
storageState ë¡œë“œ
  â†“
ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœë¡œ ì‹œì‘
  â†“
ë¡œê·¸ì¸ í˜ì´ì§€ ìŠ¤í‚µ
```

---

## 4. playwright.config.ts (ê°€ì¥ ì¤‘ìš”)

### í•µì‹¬ ì›ì¹™

- `storageState`ëŠ” **ì „ì—­(use)ì— ë‘ì§€ ì•ŠëŠ”ë‹¤**
- **setup ì œì™¸ í”„ë¡œì íŠ¸ì—ë§Œ ì ìš©**
- ê²½ë¡œëŠ” **ì ˆëŒ€ê²½ë¡œë¡œ ê³ ì •**

```tsx
import { defineConfig, devices } from '@playwright/test';
import path from 'path';

const storagePath = path.resolve(__dirname, '.auth/user.json');
export default defineConfig({
  testDir: './tests',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'https://skwinwin.com/index.asp',
    trace: 'on-first-retry',

  projects: [
    {
      name: 'setup',
      testMatch: /.*\.setup\.ts/,
      use: {
        storageState: undefined, // ğŸ”´ setupì—ì„œëŠ” ì‚¬ìš© ê¸ˆì§€
      },
    },
    {
      name: 'chromium',
      dependencies: ['setup'],
      use: { 
         ...devices['Desktop Chrome'],
         storageState: storagePath,
      },
    },

    {
      name: 'firefox',
      dependencies: ['setup'],
      use: {
         ...devices['Desktop Firefox'],
         storageState: storagePath,
      },
    },

    {
      name: 'webkit',
      dependencies: ['setup'],
      use: {
         ...devices['Desktop Safari'],
         storageState: storagePath,
      },
    },
  ],
},
});
```

---

## 5. login.page.ts (Page Object)

### ì£¼ì˜ì‚¬í•­

- `getByRole + name`ì€ **label ìˆì„ ë•Œë§Œ**
- placeholderë©´ `getByPlaceholder`
- Inspector ì¶”ì²œ locator ê·¸ëŒ€ë¡œ ì‚¬ìš©

```tsx
import { Page } from '@playwright/test';

export class LoginPage {
  readonly page: Page;

  constructor(page: Page) {
    this.page = page;
  }

  async goto() {
    await this.page.goto('/');
  }

  async login(id: string, password: string) {
    await this.page.getByRole('textbox', { name: 'IDë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”' }).fill('userid');
    await this.page.getByRole('textbox', { name: 'ë¹„ë°€ë²ˆí˜¸ë¥¼ 4ìë¦¬ ì´ìƒ ì…ë ¥í•´ ì£¼ì„¸ìš”' }).fill('pw');
    await this.page.getByRole('link', { name: 'LOGIN' }).click();
  }

  async isLoginSuccess() {
  await this.page.getByRole('banner').getByRole('link', { name: 'SK ë™ë°˜ì„±ì¥ì•„ì¹´ë°ë¯¸' }).waitFor();
  return true;
}

}
```

---

## 6. login.setup.ts (ì„¸ì…˜ ìƒì„±ì˜ í•µì‹¬)

### ì ˆëŒ€ ê·œì¹™

- URL ë³€ê²½ì— **ì˜ì¡´í•˜ì§€ ë§ ê²ƒ**
- ë¡œê·¸ì¸ ì„±ê³µì„ **í™”ë©´ ìš”ì†Œë¡œ ê²€ì¦**
- ë””ë ‰í„°ë¦¬ëŠ” ë°˜ë“œì‹œ ìƒì„±

```tsx
import { test } from '@playwright/test';
import { LoginPage } from '../../pages/login.pages.ts';
import fs from 'fs';
import path from 'path';

const storagePath = path.resolve(__dirname, '../../.auth/user.json');

test('ë¡œê·¸ì¸ ì„¸ì…˜ ìƒì„±', async ({ page }) => {
  fs.mkdirSync(path.dirname(storagePath), { recursive: true });

  const loginPage = new LoginPage(page);

  await loginPage.goto();
  await loginPage.login('userid', 'pw');

  // ë¡œê·¸ì¸ ì™„ë£Œ ì‹œì ê¹Œì§€ í™•ì‹¤íˆ ë³´ì¥
  // await page.waitForURL(/dashboard/);

  // ğŸ”´ ì´ê²Œ í•µì‹¬
  await page.context().storageState({
    path: '.auth/user.json',
  });
});
```

---

## 7. í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ (dashboard.spec.ts)

```tsx
import { test, expect } from '@playwright/test';

test('ë©”ì¸ í˜ì´ì§€ ì ‘ê·¼', async ({ page }) => {
  await page.goto('/');

  await expect(
    page.getByRole('banner').getByRole('link', { name: 'SK ë™ë°˜ì„±ì¥ì•„ì¹´ë°ë¯¸' })
  ).toBeVisible();
});
```

âŒ ID ì…ë ¥

âŒ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥

âŒ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­

â†’ **ì „ë¶€ setupì—ì„œ ë**

---

## 8. ì‹¤í–‰ ë°©ë²•

```bash
npx playwright test
```

âŒ setupë§Œ ë”°ë¡œ ì‹¤í–‰

âŒ VS Code Run ë²„íŠ¼ ë‚¨ë°œ

â­• í•­ìƒ ê°™ì€ í„°ë¯¸ë„ì—ì„œ ì „ì²´ ì‹¤í–‰

<img width="989" height="349" alt="image" src="https://github.com/user-attachments/assets/a8ae4368-d503-4054-9b67-61a0f2186d6e" />


---

## 9. ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ì™€ ì›ì¸

| ì˜¤ë¥˜ | ì›ì¸ |
| --- | --- |
| Unexpected end of JSON | setup ì‹¤íŒ¨ë¡œ íŒŒì¼ ê¹¨ì§ |
| ENOENT | storageState ê²½ë¡œ ë¶ˆì¼ì¹˜ |
| locator.fill timeout | ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœ |
| waitForURL timeout | ë¡œê·¸ì¸ í›„ URL ê°€ì • ì˜¤ë¥˜ |

---

## 10. í•µì‹¬ ìš”ì•½

- ë¡œê·¸ì¸ì€ **í…ŒìŠ¤íŠ¸ê°€ ì•„ë‹ˆë¼ í™˜ê²½ ì¤€ë¹„**
- `storageState`ëŠ” **ê²°ê³¼ë¬¼**
- setupì€ **ì„±ê³µ ë³´ì¥ êµ¬ì¡°**
- ì¼ë°˜ í…ŒìŠ¤íŠ¸ëŠ” **ë¡œê·¸ì¸ ê°€ì •**
