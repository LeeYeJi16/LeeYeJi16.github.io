---
layout: posts
title: "[Playwright] playwright 알아보기"
categories: ['sqa']
tags: [playwright]
---

# Playwright 개요

## 1. Playwright란?

Playwright는 **웹 브라우저 자동화를 위한 테스트 프레임워크**다.

웹 서비스의 UI를 실제 사용자처럼 조작하면서, 화면 동작·네트워크 요청·응답까지 함께 제어하고 검증할 수 있다.

SQA 관점에서 Playwright를 한 줄로 정리하면 이렇다.

> 브라우저를 직접 띄워 실제 사용자 흐름을 빠르고 안정적으로 검증하는 도구
> 

Chrome, Edge, Firefox, WebKit(Safari 엔진)을 **하나의 도구로 동시에 지원**하는 것이 가장 큰 특징이다.

---

## 2. Playwright는 어떻게 동작하는가

Playwright는 기존 Selenium과 구조적으로 다르다.

### 기본 구조

1. 테스트 코드 실행 (Node.js / Python 등)
2. Playwright가 브라우저 엔진과 **직접 통신**
3. 실제 브라우저 프로세스를 실행
4. 페이지 렌더링, 이벤트, 네트워크 요청을 실시간으로 제어

중요한 포인트는 **중간에 WebDriver가 없다**는 점이다.

이 구조 덕분에:

- 브라우저 제어 속도가 빠르고
- 요소 탐색 실패가 적고
- 네트워크/페이지 상태 동기화가 자동으로 처리된다

---

## 3. Playwright 구동 방식 (기본 흐름)

초보자가 이해하기 쉽게, Playwright 실행 흐름을 단순화하면 아래와 같다.

1. Playwright 설치
2. 테스트 코드 작성
3. 명령어로 테스트 실행
4. Playwright가 브라우저를 자동 실행
5. 테스트 완료 후 브라우저 종료

### 예시 (Python 기준)

- 테스트 실행 시 Playwright가 알아서 브라우저 실행
- 별도 드라이버 설치 불필요
- 테스트 코드 안에서 브라우저/페이지 생명주기 관리

이 구조 덕분에 **환경 세팅 부담이 매우 적다**.

---

## 4. Selenium과 비교했을 때 Playwright의 장점

### 1️⃣ 구조적인 안정성

| 구분 | Selenium | Playwright |
| --- | --- | --- |
| 브라우저 제어 | WebDriver 경유 | 브라우저 직접 제어 |
| 동기화 | 수동 대기 필요 | 자동 대기 기본 제공 |
| 속도 | 상대적으로 느림 | 빠름 |

Playwright는 클릭, 입력, 이동 시

> "요소가 나타날 때까지 기다린다"
> 
> 
> 를 기본 동작으로 갖고 있다.
> 

그래서 초보자가 작성해도 **실패율이 낮다**.

---

### 2️⃣ 네트워크까지 함께 제어 가능

Playwright는 UI 테스트 도구이지만:

- API 요청 가로채기
- 응답 mocking
- 상태 코드 변경

같은 작업이 가능하다.

즉,

> UI + API 흐름을 한 테스트 안에서 검증 가능
> 

이는 Selenium 단독으로는 구현 난이도가 높다.

---

### 3️⃣ 멀티 브라우저 테스트가 쉽다

Playwright는 같은 테스트 코드를:

- Chromium
- Firefox
- WebKit

에서 그대로 실행할 수 있다.

브라우저 차이 검증이 필요한 클라우드 콘솔 테스트에 특히 유리하다.

---

## 정리

Playwright는:

- 빠르고
- 안정적이며
- 실무 친화적인

차세대 웹 UI 자동화 도구다.

Selenium을 대체한다기보다는, "UI 자동화를 더 현실적으로 만든 도구" 라고 보는 게 가장 정확하다.

<br/>

# Playwright 기본 테스트 구조

## 1. 왜 테스트 구조를 이해해야 하는가

Playwright 자동화를 처음 시작할 때 가장 헷갈리는 부분은 문법이 아니라 **구조**다.

- 브라우저는 어디서 열리는지
- 페이지는 어떻게 관리되는지
- 테스트는 어떤 단위로 실행되는지

이 구조를 이해하지 못하면:

- 코드가 금방 복잡해지고
- 재사용이 어려워지고
- 실패 원인을 추적하기 힘들어진다

그래서 Playwright를 쓸 때는 **어떤 객체가 어떤 역할을 하는지**를 먼저 잡는 게 중요하다.

---

## 2. Playwright 테스트의 핵심 구성 요소

Playwright 테스트는 크게 아래 3개로 구성된다.

1. **Browser**
2. **Browser Context**
3. **Page**

이 세 가지를 이해하면 Playwright 구조의 80%는 끝난다.

---

## 3. Browser: 실제 브라우저 프로세스

### 역할

- Chromium / Firefox / WebKit 브라우저 자체
- 테스트 전체를 감싸는 가장 바깥 단위

### 특징

- 하나의 Browser는 여러 테스트에서 공유 가능
- 실제 브라우저 프로세스를 실행함

### 실무 관점 포인트

- 테스트마다 Browser를 새로 띄우면 느려진다
- 보통은 **테스트 시작 시 1회 생성**하고 재사용

---

## 4. Browser Context: 독립된 사용자 세션

### 역할

- 쿠키, 세션, 로컬스토리지를 포함한 **독립 환경**
- 시크릿 모드와 유사한 개념

### 왜 중요한가

Context 덕분에:

- 로그인 상태 테스트
- 다중 사용자 시나리오
- 테스트 간 데이터 격리

가 가능해진다.

### 실무 관점 포인트

- 테스트 케이스 단위로 Context를 분리하는 것이 기본
- 로그인 세션을 저장해 재사용하면 테스트 속도 향상

---

## 5. Page: 실제로 조작하는 화면

### 역할

- 하나의 탭(Tab)
- 클릭, 입력, 이동 등 모든 UI 액션의 대상

### 특징

- 하나의 Context 안에 여러 Page 생성 가능
- 팝업, 새 탭도 Page로 관리됨

### 실무 관점 포인트

- 테스트는 항상 Page 기준으로 작성
- Page 객체를 넘겨주며 함수 단위로 테스트 구성

---

## 6. 기본 실행 흐름 (한 눈에 보기)

Playwright 테스트의 기본 흐름은 아래와 같다.

1. Browser 실행
2. Context 생성
3. Page 생성
4. 테스트 로직 수행
5. Page / Context 종료
6. Browser 종료

이 순서를 벗어나면 테스트가 불안정해진다.

---

## 7. 테스트 코드 구조 예시 (개념 중심)

```python
with sync_playwright() as p:
    browser = p.chromium.launch()

    context = browser.new_context()
    page = context.new_page()

    page.goto("https://example.com")
    page.click("#login")

    context.close()
    browser.close()
```

이 코드에서:

- browser: 실행 환경
- context: 사용자 세션
- page: 실제 테스트 대상 화면

역할이 명확히 분리돼 있다.

---

## 8. 실무에서 추천하는 테스트 구조 방식

### 1️⃣ 공통 세팅 분리

- Browser 생성
- 로그인 처리
- 기본 Context 설정

→ 공통 코드로 분리

---

### 2️⃣ Page 단위 테스트 함수화

- 한 화면 = 하나의 Page 객체
- 페이지별 동작을 함수 또는 클래스로 관리

→ 유지보수 비용 감소

---

### 3️⃣ 테스트는 짧고 명확하게

- 하나의 테스트 = 하나의 시나리오
- 실패 원인이 바로 보이게 구성

---

## 9. 초보자가 자주 헷갈리는 포인트

- Browser와 Context를 같은 개념으로 착각
- Page를 전역으로 관리
- 테스트 종료 후 close 누락

이런 경우:

- 테스트 간 간섭 발생
- 메모리 누수
- 간헐적 실패 증가

으로 이어진다.

---

## 정리

Playwright 테스트 구조의 핵심은 단순하다.

- Browser: 환경
- Context: 사용자
- Page: 화면

이 개념만 정확히 잡으면:

- 테스트가 안정되고
- 확장성이 좋아지고
- 실무에 바로 쓸 수 있는 자동화 코드가 된다.

Playwright를 잘 쓴다는 건, 이 구조를 흔들리지 않게 유지하는 것이다.

<br/>

# Playwright 테스트 코드 작성 패턴

## 1. 왜 "패턴"이 중요한가

Playwright로 테스트를 한두 개 작성하는 건 어렵지 않다.

문제는 테스트가 **수십 개, 수백 개로 늘어났을 때** 발생한다.

- 코드 중복 증가
- 화면 변경 시 수정 범위 확대
- 테스트 의도 파악 어려움

이런 문제를 막으려면 처음부터

> "어떻게 쓸 것인가"보다 "어떻게 구조화할 것인가"
> 
> 
> 를 정해두는 게 중요하다.
> 

이 문서는 문법이 아니라 **실무에서 검증된 작성 패턴**에 집중한다.

---

## 2. 기본 원칙 (실무 기준 4가지)

### 1️⃣ 테스트 로직과 화면 제어를 분리한다

- 테스트 코드: 시나리오 설명 역할
- 화면 제어 코드: 클릭, 입력, 조회

테스트 파일 안에서 selector와 로직이 섞이기 시작하면

유지보수가 급격히 어려워진다.

---

### 2️⃣ 하나의 테스트는 하나의 시나리오만 다룬다

- 성공 + 실패를 한 테스트에서 동시에 검증하지 않는다
- 조건 분기는 최소화한다

테스트는 읽었을 때

> "이 테스트가 뭘 검증하는지"
> 
> 
> 한 줄로 설명 가능해야 한다.
> 

---

### 3️⃣ 공통 처리는 반드시 재사용 가능하게 만든다

- 로그인
- 기본 이동
- 공통 대기

이런 로직은 테스트마다 반복되면 안 된다.

---

### 4️⃣ 실패 원인이 바로 보이게 작성한다

- assert 위치 명확히
- 중간 상태 로그 최소한으로 추가

실무에서는 "왜 실패했는지"를 빠르게 아는 게 제일 중요하다.

---

## 3. 권장 디렉터리 구조 패턴

```
playwright/
├─ tests/
│  ├─ login.spec.py
│  ├─ vm_create.spec.py
│  └─ storage_mount.spec.py
│
├─ pages/
│  ├─ login_page.py
│  ├─ vm_page.py
│  └─ storage_page.py
│
├─ fixtures/
│  └─ auth.py
│
└─ utils/
   ├─ waits.py
   └─ helpers.py
```

이 구조의 핵심은:

- **tests**: 시나리오만 표현
- **pages**: 화면 조작 책임
- **fixtures/utils**: 공통 기능

---

## 4. Page Object Pattern (필수 패턴)

### 개념

- 한 화면 = 하나의 Page 클래스
- selector와 UI 동작을 캡슐화

### 왜 필요한가

- selector 변경 시 수정 범위 최소화
- 테스트 가독성 향상

### 실무 포인트

- Page 클래스에는 assert를 최소화
- "행동" 중심 메서드 구성

---

## 5. 테스트 코드 작성 패턴 (시나리오 중심)

테스트 코드는 **스토리처럼 읽혀야 한다**.

```
1. 로그인한다
2. VM 생성 화면으로 이동한다
3. 필수 값을 입력한다
4. 생성 완료를 확인한다
```

이 흐름이 코드에서 그대로 보이는 게 이상적인 상태다.

---

## 6. 공통 로그인 처리 패턴

### 권장 방식

- 로그인 테스트는 별도 작성
- 인증 완료된 Context를 저장
- 다른 테스트에서 재사용

### 장점

- 테스트 속도 향상
- 로그인 실패로 인한 연쇄 실패 방지

---

## 7. 대기(wait) 처리 패턴

### ❌ 피해야 할 방식

- time.sleep 남용

### ✅ 권장 방식

- Playwright 기본 auto-wait 활용
- 특정 상태 기준 대기

### 실무 포인트

- "보여질 때까지"가 아니라
- "동작 가능할 때까지" 기다린다

---

## 8. Assertion 작성 패턴

### 원칙

- assert는 테스트 코드에만 둔다
- Page 객체 안에는 결과 반환만 한다

### 이유

- 실패 지점을 명확히 하기 위함

---

## 9. 실패를 고려한 테스트 설계 패턴

실무 테스트는 항상 실패를 고려해야 한다.

- 네트워크 지연
- 간헐적 UI 렌더링 문제
- 이전 테스트 영향

그래서:

- 테스트 간 독립성 유지
- 상태 초기화 철저히

가 중요하다.

---

## 정리

실무에서 좋은 Playwright 테스트 코드는:

- 읽기 쉽고
- 수정하기 쉽고
- 실패 원인이 명확하다

이를 가능하게 하는 건

> 문법이 아니라 작성 패턴이다.
> 

이 패턴을 기준으로 다음 문서에서는

실제 테스트 코드를 작성하며 흐름을 연결해본다.
